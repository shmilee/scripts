# use matplotlib in jupyter-notebook
# python 3 
# select pypi-index-url $PP_index
# docker build --force-rm --no-cache --rm -f Dockerfile-matplotlib-jupyter-arc -t matplot:$(date +%y%m%d) .
# mkdir $PWD/host-workdir/{config,notebook}
# docker run --rm -u 1000 -v $PWD/host-workdir:/workdir -p 8888:8888 matplot:$(date +%y%m%d)
# configfile: $PWD/host-workdir/config/nb_config.py
# init.sh: exec jupyter-notebook? dead kernel

FROM arch:1605
MAINTAINER shmilee <shmilee.zju@gmail.com>

ENV LANG=en_US.UTF-8 LC_ALL=en_US.UTF-8

RUN PP_index='https://pypi.python.org/simple' && \
    PP_index='https://pypi.tuna.tsinghua.edu.cn/simple' && \
    packages=(python-pip \
        ipython \
        jupyter-notebook \
        jupyter-nbconvert \
        python-numpy \
        python-scipy \
        python-pandas \
        python-sympy \
        mathjax \
        pandoc \
        python-pillow python-pyparsing  python-cycler \
        pkg-config freetype2 gcc) && \
    pacman -Sy --noconfirm ${packages[@]} && \
    pip3 install -i "$PP_index" matplotlib && \
    pacman -Rsn --noconfirm gcc && \
    useradd -m -g users -G wheel -s /bin/bash -d /workdir -u 1000 shmilee && \
    find /usr/lib/python3* \
		    \( -type d -a -name test -o -name tests \) \
		    -exec rm -rf '{}' + ; \
    rm -rf /usr/share/{man/*,doc/*,gtk-doc/,info/} /{root,tmp} && \
    rm -r /var/cache/pacman/pkg/* && \
    rm -r /var/lib/pacman/sync/* && \
    echo -e '#!/bin/bash\nsleep ${1:-5}' >/usr/bin/init.sh && \
    echo 'jupyter-notebook --config=/workdir/config/nb_config.py' >>/usr/bin/init.sh && \
    chmod +x /usr/bin/init.sh

WORKDIR /workdir/notebook
CMD ["init.sh", "3"]
