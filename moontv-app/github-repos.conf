## app name as key, any string, like short-version
declare -a AppNames=(
    'v100' # the final official version, 2025-08-27
)

## name: github-url, fmt: https://github.com/..????/????TV
declare -A AppUrls=(
    ['v100']='https://github.com/MoonTechLab/LunaTV'
)

## download https://github.com/..????/????TV/archive/${commit}.tar.gz
declare -A AppCommits=(
    ['v100']='586ab2a0588ed838aee2ab80892887a38cd4280d'
)

## app release version, fmt: X.Y.Z.rNNN
## X.Y.Z may not match the commit, but number of commits NNN does.
declare -A AppVersions=(
    ['v100']='100.0.0.r118'
)

## app patch files, a.patch:b.patch:...
## ---+++, a-name/src/xx/yy/zz vs what-patch/src/xx/yy/zz
declare -A AppPatches=(
    ['v100']='01-open-with-mpv.patch:11-config-collections.patch:12-config-collections-cron.patch'
)

## which app's node_modules squashfs file to use, defult: v100
declare -A AppNodemodsNames=(
    ['defult']='v100'
)

## exclude app's node_modules in squashfs file
## fmt: extended patterns. default: '', exclude nothing
declare -A AppNodemodsExclude=(
    ['defult']=''
)

## which app's valkey dbfilename to use, defult: valkey-moontv.rdb
## fmt: valkey-Name.rdb
declare -A AppValkeydbfilenames=(
    ['defult']='valkey-moontv.rdb'
)

## config-collections/{moontv-XXXXX,iptv-XXXXX}
## fmt: [moontv-XXXXX]='url'
declare -A ConfigCollections=(
    ['moontv-hafrey1-config.txt']='https://github.com/hafrey1/LunaTV-config/raw/refs/heads/main/LunaTV-config.txt'
    ['moontv-senshinya-gistfile.txt']='https://gist.github.com/senshinya/5a5cb900dfa888fd61d767530f00fc48/raw/gistfile1.txt'
    ['iptv-YanG.m3u']='https://tv.iill.top/m3u/Gather'  # https://yang-1989.eu.org/
    ['iptv-Guovin-ipv4.m3u']='https://github.com/Guovin/iptv-api/raw/refs/heads/master/output/ipv4/result.m3u'
)

# download cmd/agent
CURLCMD='curl -fLC - --retry 3 --retry-delay 3 --proxy socks5://127.0.0.1:8087'

## Add other version apps
#AppNames+=('')
#AppUrls['']=''
#AppCommits['']=''
#AppVersions['']=''
#AppPatches['']=''           # optional
#AppNodemodsNames['']=''     # optional
#AppNodemodsExclude['']=''   # optional
#AppValkeydbfilenames['']='' # optional

AppNames+=('v2s')
AppUrls['v2s']='https://github.com/Stardm0/MoonTV'
AppCommits['v2s']='a63d458988b2e451f7a276500902e9f7c8f16723' # 2025-09-04
# freeze, 2.8.0 /3d1ecf7e1cedabeaed97cbdfb42b297e7c2bde60 package.json changed
AppVersions['v2s']='2.7.6.r87'
AppPatches['v2s']='01-open-with-mpv.patch'

AppNames+=('v5s')
AppUrls['v5s']='https://github.com/SzeMeng76/LunaTV'
AppCommits['v5s']='204903b7f3b80ae65d9cdb4e3d061362f7d47a34' # 2025-09-24
AppVersions['v5s']='5.5.0.r661'
AppPatches['v5s']='01-open-with-mpv.patch:11-config-collections.patch:12-config-collections-cron-v5s-r621+.patch'
#AppValkeydbfilenames['v5s']='valkey-v5s.rdb'

AppNames+=('v7j')
AppUrls['v7j']='https://github.com/joyce677/NewTV'
AppCommits['v7j']='f60ddbfc878a291ded1790375bec9b1796e4515c' # 2025-09-22
# freeze, personal closed, /36fb82beb9f1b9f886392a391cc4fc39502dd64f
AppVersions['v7j']='7.2.1.r845'
AppPatches['v7j']="${AppPatches['v100']}"

AppNames+=('v0k')
AppUrls['v0k']='https://github.com/katelya77/KatelyaTV'
AppCommits['v0k']='3ce1bd1ce4be0e8663766959e18c16387f573fac' # 2025-09-05
# freeze, https://github.com/katelya77/KatelyaTV/issues/93
AppVersions['v0k']='0.7.0.r198'
AppNodemodsNames['v0k']='v0k'
AppNodemodsExclude['v0k']='esbuild-linux|img\+sharp-libvips-linux'


## functions: get_xxx name
get_gituser() { echo "${AppUrls[$1]}" | awk -F/ '{print $4}'; }
get_gitrepo() { echo "${AppUrls[$1]}" | awk -F/ '{print $5}'; }
get_appver() { echo "${AppVersions[$1]}-g${AppCommits[$1]:0:7}"; }
# appdir fmt: ???-????tv-version. lower? appdir="${appdir,,}"
get_appdir() { echo "$(get_gituser $1)-$(get_gitrepo $1)-v$(get_appver $1)"; }
#get_showrepo() { echo "${AppUrls[$1]}" | sed 's|https://github.com/||'; }
get_showrepo() { echo "${AppUrls[$1]}" | sed 's|.*github.com/\(..\).*\(/.*$\)|\1???\2|'; }
get_nodemodsname() { echo "${AppNodemodsNames[$1]:-${AppNodemodsNames['defult']}}"; }
get_nodemodsexclude() { echo "${AppNodemodsExclude[$1]:-${AppNodemodsExclude['defult']}}"; }
get_nodemodsquashfs() { echo "$(get_appdir $1)-node_modules.squashfs"; }
get_valkeydbfile() { echo "${AppValkeydbfilenames[$1]:-${AppValkeydbfilenames['defult']}}"; }
