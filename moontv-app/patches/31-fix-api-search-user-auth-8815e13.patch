From 8815e138e5857722965f1123b777aa6c96930b25 Mon Sep 17 00:00:00 2001
From: shinya <kobayashi_shinya@outlook.com>
Date: Thu, 23 Oct 2025 13:02:02 +0800
Subject: [PATCH] /api/search/resources add user check

---
 src/app/api/search/resources/route.ts |  9 ++++++---
 1 files changed, 6 insertions(+), 3 deletions(-)

diff --git a/src/app/api/search/resources/route.ts b/src/app/api/search/resources/route.ts
index a4eb218f3..beed1cb85 100644
--- a/src/app/api/search/resources/route.ts
+++ b/src/app/api/search/resources/route.ts
@@ -1,16 +1,19 @@
 /* eslint-disable no-console */
 
 import { NextRequest, NextResponse } from 'next/server';
-
+import { getAuthInfoFromCookie } from '@/lib/auth';
 import { getAvailableApiSites } from '@/lib/config';
 
 export const runtime = 'nodejs';
 
 // OrionTV 兼容接口
 export async function GET(request: NextRequest) {
-  console.log('request', request.url);
+  const authInfo = getAuthInfoFromCookie(request);
+  if (!authInfo || !authInfo.username) {
+    return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });
+  }
   try {
-    const apiSites = await getAvailableApiSites();
+    const apiSites = await getAvailableApiSites(authInfo.username);
 
     return NextResponse.json(apiSites);
   } catch (error) {
